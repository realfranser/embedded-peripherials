00000000                                     1      ORG     $0
00000000  00008000                           2      DC.L    $8000           * Pila
00000004  00004844                           3      DC.L    INICIO          * PC
00000008                                     4      
00000008                                     5  ***************************************************************************
00000008                                     6  *   █████████     ███████    ██████████   █████   █████████     ███████   *
00000008                                     7  *  ███░░░░░███  ███░░░░░███ ░░███░░░░███ ░░███   ███░░░░░███  ███░░░░░███ *
00000008                                     8  * ███     ░░░  ███     ░░███ ░███   ░░███ ░███  ███     ░░░  ███     ░░███*
00000008                                     9  *░███         ░███      ░███ ░███    ░███ ░███ ░███         ░███      ░███*
00000008                                    10  *░███         ░███      ░███ ░███    ░███ ░███ ░███    █████░███      ░███*
00000008                                    11  *░░███     ███░░███     ███  ░███    ███  ░███ ░░███  ░░███ ░░███     ███ *
00000008                                    12  * ░░█████████  ░░░███████░   ██████████   █████ ░░█████████  ░░░███████░  *
00000008                                    13  *  ░░░░░░░░░     ░░░░░░░    ░░░░░░░░░░   ░░░░░   ░░░░░░░░░     ░░░░░░░    *
00000008                                    14  ***************************************************************************
00000400                                    15      ORG     $400
00000400                                    16      
00000400  =000007D0                         17  TAMANYO EQU     2000          * Buffer para escritura y lectura de caracteres
00000400                                    18  
00000400  =00EFFC01                         19  MR1A    EQU     $effc01       * de modo A (escritura)
00000400  =00EFFC01                         20  MR2A    EQU     $effc01       * de modo A (2º escritura)
00000400  =00EFFC03                         21  SRA     EQU     $effc03       * de estado A (lectura)
00000400  =00EFFC03                         22  CSRA    EQU     $effc03       * de seleccion de reloj A (escritura)
00000400  =00EFFC05                         23  CRA     EQU     $effc05       * de control A (escritura)
00000400  =00EFFC07                         24  TBA     EQU     $effc07       * buffer transmision A (escritura)
00000400  =00EFFC07                         25  RBA     EQU     $effc07       * buffer recepcion A  (lectura)
00000400                                    26  
00000400  =00EFFC11                         27  MR1B    EQU     $effc11       * de modo B (escritura)
00000400  =00EFFC11                         28  MR2B    EQU     $effc11       * de modo B (2º escritura)
00000400  =00EFFC13                         29  SRB     EQU     $effc13       * de estado B (lectura)
00000400  =00EFFC13                         30  CSRB    EQU     $effc13       * de seleccion de reloj B (escritura)
00000400  =00EFFC15                         31  CRB     EQU     $effc15       * de control B (escritura)
00000400  =00EFFC17                         32  TBB     EQU     $effc17       * buffer transmision B (escritura)
00000400  =00EFFC17                         33  RBB     EQU     $effc17       * buffer recepcion B  (lectura)
00000400                                    34  
00000400  =00EFFC09                         35  ACR     EQU     $effc09       * de control auxiliar
00000400  =00EFFC0B                         36  IMR     EQU     $effc0B       * de mascara de interrupcion ambas (escritura)
00000400  =00EFFC0B                         37  ISR     EQU     $effc0B       * de estado de interrupcion de ambas (lectura)
00000400  =00EFFC19                         38  IVR     EQU     $effc19       * vector de interrupccion de AMBAS
00000400                                    39  
00000400                                    40  
00000400                                    41  ***************************
00000400                                    42  *██╗███╗   ██╗██╗████████╗*
00000400                                    43  *██║████╗  ██║██║╚══██╔══╝*
00000400                                    44  *██║██╔██╗ ██║██║   ██║   *
00000400                                    45  *██║██║╚██╗██║██║   ██║   *
00000400                                    46  *██║██║ ╚████║██║   ██║   *
00000400                                    47  *╚═╝╚═╝  ╚═══╝╚═╝   ╚═╝   *
00000400                                    48  ***************************
00000400                                    49  
00000400                                    50      INIT:
00000400  207C 000005C6                     51          MOVE.L    #V,A0        * Vector de buffers internos
00000406                                    52  
00000406  20BC 00001000                     53          MOVE.L    #V0,(A0)
0000040C  217C 000017D8 0004                54          MOVE.L    #V1,4(A0)
00000414  217C 00001FB0 0008                55          MOVE.L    #V2,8(A0)
0000041C  217C 00002788 000C                56          MOVE.L    #V3,12(A0)
00000424                                    57          
00000424                                    58          * Preparación de periféricos
00000424  13FC 0010 00EFFC05                59          MOVE.B    #%00010000,CRA      * Reinicia el puntero MR1
0000042C  13FC 0003 00EFFC01                60          MOVE.B    #%00000011,MR1A     * Solicita interrupccion por cada caracter. 8 bits por caracter
00000434  13FC 0000 00EFFC01                61          MOVE.B    #%00000000,MR2A     * Eco desactivado.
0000043C  13FC 00CC 00EFFC03                62          MOVE.B    #%11001100,CSRA     * Velocidad = 38400 bps.
00000444  13FC 0000 00EFFC09                63          MOVE.B    #%00000000,ACR      * Velocidad = 38400 bps.
0000044C  13FC 0005 00EFFC05                64          MOVE.B    #%00000101,CRA      * Transmision y recepcion activados.
00000454                                    65  
00000454  13FC 0010 00EFFC15                66          MOVE.B    #%00010000,CRB      * Reinicia el puntero MR1
0000045C  13FC 0003 00EFFC11                67          MOVE.B    #%00000011,MR1B     * Solicita interrupccion por cada caracter. 8 bits por caracter.
00000464  13FC 0000 00EFFC11                68          MOVE.B    #%00000000,MR2B     * Eco desactivado.
0000046C  13FC 00CC 00EFFC13                69          MOVE.B    #%11001100,CSRB     * Velocidad = 38400 bps.
00000474  13FC 0005 00EFFC15                70          MOVE.B    #%00000101,CRB      * Transmision y recepcion activados.
0000047C                                    71  
0000047C                                    72          *MOVE.B    #%00100010,IMRCOPY  * Permitir interrupción de recepción
0000047C                                    73          *MOVE.B    IMRCOPY,IMR
0000047C                                    74  
0000047C                                    75          *MOVE.L    #RTI,$100           * 256 = 64 * 4
0000047C  13FC 0040 00EFFC19                76          MOVE.B    #$40,IVR            * Vector de interrupcion = 64
00000484                                    77          
00000484                                    78          * MOVE.W    #$2000,SR           * Permite interrupciones
00000484  4E75                              79          RTS
00000486                                    80  
00000486                                    81  
00000486                                    82  **************************************************
00000486                                    83  *██╗     ███████╗███████╗ ██████╗ █████╗ ██████╗ *
00000486                                    84  *██║     ██╔════╝██╔════╝██╔════╝██╔══██╗██╔══██╗*
00000486                                    85  *██║     █████╗  █████╗  ██║     ███████║██████╔╝*
00000486                                    86  *██║     ██╔══╝  ██╔══╝  ██║     ██╔══██║██╔══██╗*
00000486                                    87  *███████╗███████╗███████╗╚██████╗██║  ██║██║  ██║*
00000486                                    88  *╚══════╝╚══════╝╚══════╝ ╚═════╝╚═╝  ╚═╝╚═╝  ╚═╝*
00000486                                    89  **************************************************
00000486                                    90      LEECAR:
00000486                                    91          * Selección de buffer
00000486  C0BC 00000003                     92          AND.L   #$3,D0
0000048C  E580                              93          ASL.L   #2,D0
0000048E  207C 000005C6                     94          MOVE.L  #V,A0
00000494  2070 0000                         95          MOVE.L  (A0,D0),A0
00000498                                    96                  
00000498                                    97          *Comprobación de buffer vacío
00000498  0C68 0000 0004                    98          CMP     #0,4(A0)
0000049E  6700 007A                         99          BEQ     b_vacio
000004A2                                   100          
000004A2  3210                             101          MOVE    (A0),D1
000004A4  1030 1008                        102          MOVE.B  8(A0,D1),D0
000004A8                                   103          
000004A8                                   104          *Actualización de variables
000004A8  5250                             105          ADD     #1,(A0)      * Incrementa "inicio"
000004AA  40C7                             106          MOVE    SR,D7                                  * Inicio seccion crítica
000004AC  46FC 2700                        107          MOVE    #$2700,SR                              * Inicio seccion critica
000004B0  5368 0004                        108          SUB     #1,4(A0)     * Decrementa "tamanyo"    *
000004B4  46C7                             109          MOVE    D7,SR                                  * Fin sección crítica
000004B6                                   110  
000004B6                                   111          *Comprobamos que inicio no se pasa de 2000 
000004B6  0C50 07D0                        112          CMP     #2000,(A0)
000004BA  6D00 0006                        113          BLT     modLee
000004BE  0450 07D0                        114          SUB     #2000,(A0)
000004C2                                   115  
000004C2                                   116          modLee:                                        
000004C2  B078 0000                        117          CMP 0,D0 
000004C6  6700 001C                        118          BEQ lee_recA
000004CA  B078 0001                        119          CMP 1,D0
000004CE  6700 0020                        120          BEQ lee_recB
000004D2  B078 0002                        121          CMP 2,D0
000004D6  6700 0024                        122          BEQ lee_traA
000004DA  B078 0003                        123          CMP 3,D0
000004DE  6700 0028                        124          BEQ lee_traB
000004E2  4E75                             125          RTS
000004E4                                   126  
000004E4                                   127          lee_recA:
000004E4  33F8 0000 00EFFC07               128              MOVE 0,RBA
000004EC  6700 0026                        129              BEQ ret_lee
000004F0                                   130          lee_recB:
000004F0  33F8 0000 00EFFC17               131              MOVE 0,RBB
000004F8  6700 001A                        132              BEQ ret_lee
000004FC                                   133          lee_traA:
000004FC  33F8 0000 00EFFC07               134              MOVE 0,TBA
00000504  6700 000E                        135              BEQ ret_lee
00000508                                   136          lee_traB:
00000508  33F8 0000 00EFFC17               137              MOVE 0,TBB
00000510  6700 0002                        138              BEQ ret_lee
00000514                                   139          
00000514                                   140          ret_lee:
00000514  3038 0000                        141              MOVE 0,D0
00000518  4E75                             142              RTS
0000051A                                   143  
0000051A                                   144          b_vacio:
0000051A  70FF                             145              MOVE.L  #-1,D0
0000051C  4E75                             146              RTS
0000051E                                   147          
0000051E                                   148  **************************************************
0000051E                                   149  *███████╗███████╗ ██████╗ ██████╗ █████╗ ██████╗ *
0000051E                                   150  *██╔════╝██╔════╝██╔════╝██╔════╝██╔══██╗██╔══██╗*
0000051E                                   151  *█████╗  ███████╗██║     ██║     ███████║██████╔╝*
0000051E                                   152  *██╔══╝  ╚════██║██║     ██║     ██╔══██║██╔══██╗*
0000051E                                   153  *███████╗███████║╚██████╗╚██████╗██║  ██║██║  ██║*
0000051E                                   154  *╚══════╝╚══════╝ ╚═════╝ ╚═════╝╚═╝  ╚═╝╚═╝  ╚═╝*
0000051E                                   155  **************************************************
0000051E                                   156                                                  
0000051E                                   157  
0000051E                                   158      ESCCAR:
0000051E                                   159          * Selección de buffer
0000051E  C0BC 00000003                    160          AND.L   #$3,D0
00000524  E580                             161          ASL.L   #2,D0
00000526  307C 05C6                        162          MOVE    #V,A0
0000052A  2070 0000                        163          MOVE.L  (A0,D0),A0
0000052E                                   164          
0000052E                                   165          * Comprobación de buffer lleno
0000052E  0C68 07D0 0004                   166          CMP     #2000,4(A0)
00000534  6700 007A                        167          BEQ     b_lleno
00000538                                   168  
00000538  3428 0002                        169          MOVE    2(A0),D2
0000053C  1181 2008                        170          MOVE.B  D1,8(A0,D2)
00000540                                   171          
00000540                                   172          * Actualización de variables
00000540  5268 0002                        173          ADD     #1,2(A0)   * Incrementar "fin"         
00000544  40C7                             174          MOVE    SR,D7                                  * Inicio Sección crítica
00000546  46FC 2700                        175          MOVE    #$2700,SR                              * Inicio Sección crítica
0000054A  5268 0004                        176          ADD     #1,4(A0)   * Incrementar "tamano"      *
0000054E  46C7                             177          MOVE    D7,SR                                  * Fin sección crítica
00000550                                   178  
00000550                                   179          *Comprobamos que fin no se pasa de 2000        
00000550  0C68 07D0 0002                   180          CMP     #2000,2(A0)                            
00000556  6D00 0008                        181          BLT     modEsc                                 
0000055A  0468 07D0 0002                   182          SUB     #2000,2(A0)                            
00000560                                   183                                                         
00000560                                   184          modEsc:                                        
00000560  B078 0000                        185          CMP 0,D0 
00000564  6700 001C                        186          BEQ es_recA
00000568  B078 0001                        187          CMP 1,D0
0000056C  6700 001E                        188          BEQ es_recB
00000570  B078 0002                        189          CMP 2,D0
00000574  6700 0020                        190          BEQ es_traA
00000578  B078 0003                        191          CMP 3,D0
0000057C  6700 0022                        192          BEQ es_traB
00000580  4E75                             193          RTS
00000582                                   194  
00000582                                   195          es_recA:
00000582  33C1 00EFFC07                    196              MOVE D1,RBA
00000588  6700 0020                        197              BEQ ret_es
0000058C                                   198          es_recB:
0000058C  33C1 00EFFC17                    199              MOVE D1,RBB
00000592  6700 0016                        200              BEQ ret_es
00000596                                   201          es_traA:
00000596  33C1 00EFFC07                    202              MOVE D1,TBA
0000059C  6700 000C                        203              BEQ ret_es
000005A0                                   204          es_traB:
000005A0  33C1 00EFFC17                    205              MOVE D1,TBB
000005A6  6700 0002                        206              BEQ ret_es
000005AA                                   207          
000005AA                                   208          ret_es:
000005AA  3038 0000                        209              MOVE 0,D0
000005AE  4E75                             210              RTS
000005B0                                   211  
000005B0                                   212          b_lleno:
000005B0  70FF                             213              MOVE.L  #-1,D0
000005B2  4E75                             214              RTS
000005B4                                   215          
000005B4                                   216  
000005B4                                   217  ************************************
000005B4                                   218  *███████╗ ██████╗ █████╗ ███╗   ██╗*
000005B4                                   219  *██╔════╝██╔════╝██╔══██╗████╗  ██║*
000005B4                                   220  *███████╗██║     ███████║██╔██╗ ██║*
000005B4                                   221  *╚════██║██║     ██╔══██║██║╚██╗██║*
000005B4                                   222  *███████║╚██████╗██║  ██║██║ ╚████║*
000005B4                                   223  *╚══════╝ ╚═════╝╚═╝  ╚═╝╚═╝  ╚═══╝*
000005B4                                   224  ************************************
000005B4                                   225  
000005B4                                   226  
000005B4                                   227      SCAN:
000005B4  C0BC 00000003                    228          AND.L #$3,D0
000005BA                                   229  
000005BA                                   230  ****************************************
000005BA                                   231  *██████╗ ██████╗ ██╗███╗   ██╗████████╗*
000005BA                                   232  *██╔══██╗██╔══██╗██║████╗  ██║╚══██╔══╝*
000005BA                                   233  *██████╔╝██████╔╝██║██╔██╗ ██║   ██║   *
000005BA                                   234  *██╔═══╝ ██╔══██╗██║██║╚██╗██║   ██║   *
000005BA                                   235  *██║     ██║  ██║██║██║ ╚████║   ██║   *
000005BA                                   236  *╚═╝     ╚═╝  ╚═╝╚═╝╚═╝  ╚═══╝   ╚═╝   *
000005BA                                   237  ****************************************
000005BA                                   238                                        
000005BA                                   239      PRINT:
000005BA  C0BC 00000003                    240          AND.L #$3,D0
000005C0                                   241                                            
000005C0                                   242      RTI:
000005C0  C0BC 00000003                    243          AND.L #$3,D0
000005C6                                   244  *******************************************************************************
000005C6                                   245  *   REGIÓN DE VARIABLES GLOBALES
000005C6                                   246  ********************************************************************************
000005C6  00000000 00000000 00000000 ...   247      V:      DC.L   0,0,0,0
000005D6  00                               248      IMRCOPY:DC.B   0
000005D7                                   249  
000005D7                                   250  ********************************************************************************
000005D7                                   251  *   REGIÓN DE HEAP
000005D7                                   252  ********************************************************************************
00001000                                   253      ORG     $1000
00001000                                   254  
00001000                                   255  *
00001000  0000 0000 0000 0000              256      V0:     DC.W   0,0,0,0
00001008                                   257              DS.B   TAMANYO
000017D8  0000 0000 0000 0000              258      V1:     DC.W   0,0,0,0
000017E0                                   259              DS.B   TAMANYO
00001FB0  0000 0000 0000 0000              260      V2:     DC.W   0,0,0,0
00001FB8                                   261              DS.B   TAMANYO
00002788  0000 0000 0000 0000              262      V3:     DC.W   0,0,0,0
00002790                                   263              DS.B   TAMANYO
00002F60                                   264  
00002F60                                   265  ********************************************************************************************
00002F60                                   266  *███████████  ███████████   █████  █████ ██████████ ███████████    █████████    █████████  *
00002F60                                   267  *░░███░░░░░███░░███░░░░░███ ░░███  ░░███ ░░███░░░░░█░░███░░░░░███  ███░░░░░███  ███░░░░░███00002F60                                   268  *
00002F60                                   269  * ░███    ░███ ░███    ░███  ░███   ░███  ░███  █ ░  ░███    ░███ ░███    ░███ ░███    ░░░ *
00002F60                                   270  * ░██████████  ░██████████   ░███   ░███  ░██████    ░██████████  ░███████████ ░░█████████ *
00002F60                                   271  * ░███░░░░░░   ░███░░░░░███  ░███   ░███  ░███░░█    ░███░░░░░███ ░███░░░░░███  ░░░░░░░░███*
00002F60                                   272  * ░███         ░███    ░███  ░███   ░███  ░███ ░   █ ░███    ░███ ░███    ░███  ███    ░███*
00002F60                                   273  * █████        █████   █████ ░░████████   ██████████ ███████████  █████   █████░░█████████ *
00002F60                                   274  *░░░░░        ░░░░░   ░░░░░   ░░░░░░░░   ░░░░░░░░░░ ░░░░░░░░░░░  ░░░░░   ░░░░░  ░░░░░░░░░  *
00002F60                                   275  ********************************************************************************************
00002F60                                   276  
00004000                                   277      ORG     $4000
00004000                                   278  
00004000                                   279  BUFFER: DS.B    2100   * Buffer para escritura y lectura de caracteres
00004834  0000                             280  CONTL:  DC.W    0      * Contador de lineas
00004836  0000                             281  CONTC:  DC.W    0      * Contador de caracteres
00004838  00000000                         282  DIRLEC: DC.L    0      * Direccion de lectura para SCAN
0000483C  00000000                         283  DIRESC: DC.L    0      * Direccion de lectura para PRINT
00004840  00000000                         284  TAME:   DC.L    0      * Tamano de escritura para print
00004844  =00000000                        285  DESA:   EQU     0      * Descriptor linea A
00004844  =00000001                        286  DESB:   EQU     1      * Descriptor linea B
00004844                                   287  
00004844  =0000000F                        288  NLIN:   EQU     15     * Numero de lineas a leer
00004844  =00000064                        289  TAML:   EQU     100    * Tamano de linea para SCAN
00004844  =00000005                        290  TAMB:   EQU     5      * Tamano de bloque para PRINT
00004844                                   291      
00004844                                   292      
00004844                                   293  INICIO: * Manejadores de excepciones
00004844  21FC 00004868 0008               294      MOVE.L  #BUS_ERROR,8     * Bus error handler
0000484C  21FC 0000486C 000C               295      MOVE.L  #ADDRESS_ER,12   * Address error handler
00004854  21FC 00004870 0010               296      MOVE.L  #ILLEGAL_IN,16   * Illegal instruction handler
0000485C  21FC 00004874 0020               297      MOVE.L  #PRIV_VIOLT,32   * Privilege Violation handler
00004864                                   298  
00004864  6100 BB9A                        299      BSR     INIT
00004868                                   300  *    MOVE.L    #V,A0        * Vector de buffers internos
00004868                                   301  *
00004868                                   302  *    MOVE.L    #V0,(A0)
00004868                                   303  *    MOVE.L    #V1,4(A0)
00004868                                   304  *    MOVE.L    #V2,8(A0)
00004868                                   305  *    MOVE.L    #V3,12(A0)
00004868                                   306  *
00004868                                   307  *
00004868                                   308  ***************************************************
00004868                                   309  **██╗     ███████╗███████╗ ██████╗ █████╗ ██████╗ *
00004868                                   310  **██║     ██╔════╝██╔════╝██╔════╝██╔══██╗██╔══██╗*
00004868                                   311  **██║     █████╗  █████╗  ██║     ███████║██████╔╝*
00004868                                   312  **██║     ██╔══╝  ██╔══╝  ██║     ██╔══██║██╔══██╗*
00004868                                   313  **███████╗███████╗███████╗╚██████╗██║  ██║██║  ██║*
00004868                                   314  **╚══════╝╚══════╝╚══════╝ ╚═════╝╚═╝  ╚═╝╚═╝  ╚═╝*
00004868                                   315  ***************************************************
00004868                                   316  *
00004868                                   317  **** Prueba 2: Llamada a ESCCAR introduciendo un caracter en el buffer de recepción de la línea A (0)
00004868                                   318  ****
00004868                                   319  **************************************************************************************************************************
00004868                                   320  ***
00004868                                   321  *pr02es_int:
00004868                                   322  *    MOVE.L #0,D0
00004868                                   323  *    MOVE.L #1,D1
00004868                                   324  *    BSR ESCCAR
00004868                                   325  *    BRA COMPCOR
00004868                                   326  **************************************************************************************************************************
00004868                                   327  ***
00004868                                   328  **** Prueba 3: Se escriben 10 caracteres en el buffer de recepción de la linea B(1) (10 llamadas a ESCCAR).
00004868                                   329  ****
00004868                                   330  **************************************************************************************************************************
00004868                                   331  ***
00004868                                   332  *pr03es_int:
00004868                                   333  *    MOVE.L #10,D3
00004868                                   334  *    MOVE.L #1,D7
00004868                                   335  *    BSR BUCESN1S
00004868                                   336  *    BRA COMPCOR
00004868                                   337  **************************************************************************************************************************
00004868                                   338  ***
00004868                                   339  **** Prueba 4: Se escriben 300 caracteresen el buffer de transmisión de la linea A (2) (300 llamadas a ESCCAR).
00004868                                   340  ****
00004868                                   341  **************************************************************************************************************************
00004868                                   342  ***
00004868                                   343  *pr04es_int:
00004868                                   344  *    MOVE.L #2,D7
00004868                                   345  *    MOVE.L #300,D3
00004868                                   346  *    BSR BUCESNFF
00004868                                   347  *    BRA COMPCOR
00004868                                   348  *
00004868                                   349  **************************************************************************************************************************
00004868                                   350  ***
00004868                                   351  **** Prueba 5: Se escriben 2000 caracteresen el buffer de transmisión de la linea B (3) (2000 llamadas a ESCCAR).
00004868                                   352  ****
00004868                                   353  **************************************************************************************************************************
00004868                                   354  ***
00004868                                   355  *pr05es_int:
00004868                                   356  *    MOVE.L #2000,D3
00004868                                   357  *    MOVE.L #3,D7
00004868                                   358  *    BSR BUCESNFF
00004868                                   359  *    BRA COMPCOR
00004868                                   360  **************************************************************************************************************************
00004868                                   361  ***
00004868                                   362  **** Prueba 6: Se escriben más de 2000 caracteresen el buffer de transmisión de la linea B (3) (2001 llamadas a ESCCAR). ***
00004868                                   363  **************************************************************************************************************************
00004868                                   364  ***
00004868                                   365  *pr06es_int:
00004868                                   366  *    MOVE.L #2000,D3
00004868                                   367  *    MOVE.L #3,D7
00004868                                   368  *    BSR BUCESNFF
00004868                                   369  *    MOVE.L #3,D0
00004868                                   370  *    MOVE.L #11,D1 * caracter 2001
00004868                                   371  *    BSR ESCCAR
00004868                                   372  *    BRA COMPF
00004868                                   373  **************************************************************************************************************************
00004868                                   374  ***
00004868                                   375  **** Prueba 7: Se prueba a leer un caracter de un buffer vacío (LEECAR buffer recepcion línea A)
00004868                                   376  ****
00004868                                   377  **************************************************************************************************************************
00004868                                   378  ***
00004868                                   379  *pr07es_int:
00004868                                   380  *    MOVE.L #0,D0
00004868                                   381  *    BSR LEECAR
00004868                                   382  *    BRA COMPF
00004868                                   383  **************************************************************************************************************************
00004868                                   384  ***
00004868                                   385  *
00004868                                   386  *
00004868                                   387  **** Prueba 8: Se prueba a leer un caracter con 200 escritos en el buffer (LEECAR buffer recepcion línea A(0))
00004868                                   388  ****
00004868                                   389  **************************************************************************************************************************
00004868                                   390  ***
00004868                                   391  *pr08es_int:
00004868                                   392  *    MOVE.L #200,D3
00004868                                   393  *    MOVE.L #0,D7
00004868                                   394  *    BSR BUCESNFF
00004868                                   395  *    MOVE.L #0,D0
00004868                                   396  *    BSR LEECAR
00004868                                   397  *    CMP.L #0,D0
00004868                                   398  *    BEQ BIEN
00004868                                   399  *    MOVE.L #-1,D5
00004868                                   400  *    BRA FINC
00004868                                   401  **************************************************************************************************************************
00004868                                   402  ***
00004868                                   403  **** Prueba 9: Se prueba a leer 10 caracteres con 300 escritos en el buffer (LEECAR buffer recepcion línea B(1))
00004868                                   404  ****
00004868                                   405  **************************************************************************************************************************
00004868                                   406  ***
00004868                                   407  *pr09es_int:
00004868                                   408  *    MOVE.L #200,D3
00004868                                   409  *    MOVE.L #1,D7
00004868                                   410  *    BSR BUCESNFF
00004868                                   411  *    MOVE.L #1,D7
00004868                                   412  *    MOVE.L #10,D3
00004868                                   413  *    BSR BUCLEEN
00004868                                   414  *    CMP.L #$9,D0
00004868                                   415  *    BEQ BIEN
00004868                                   416  *    MOVE.L #-1,D5
00004868                                   417  *    BRA FINC
00004868                                   418  *
00004868                                   419  **************************************************************************************************************************
00004868                                   420  ***
00004868                                   421  **** Prueba 10: Se prueba a leer 300 caracteres con 300 escritos en el buffer (LEECAR buffer transmisión línea A(2)) ***
00004868                                   422  **************************************************************************************************************************
00004868                                   423  ***
00004868                                   424  *pr10es_int:
00004868                                   425  *    MOVE.L #300,D3
00004868                                   426  *    MOVE.L #2,D7
00004868                                   427  *    BSR BUCESNFF
00004868                                   428  *    MOVE.L #2,D7
00004868                                   429  *    MOVE.L #300,D3
00004868                                   430  *    BSR BUCLEEN
00004868                                   431  *    CMP.L #$2B,D0
00004868                                   432  *    BEQ BIEN
00004868                                   433  *    MOVE.L #-1,D5
00004868                                   434  *    BRA FINC
00004868                                   435  *
00004868                                   436  *
00004868                                   437  ***************************************************
00004868                                   438  **███████╗███████╗ ██████╗ ██████╗ █████╗ ██████╗ *
00004868                                   439  **██╔════╝██╔════╝██╔════╝██╔════╝██╔══██╗██╔══██╗*
00004868                                   440  **█████╗  ███████╗██║     ██║     ███████║██████╔╝*
00004868                                   441  **██╔══╝  ╚════██║██║     ██║     ██╔══██║██╔══██╗*
00004868                                   442  **███████╗███████║╚██████╗╚██████╗██║  ██║██║  ██║*
00004868                                   443  **╚══════╝╚══════╝ ╚═════╝ ╚═════╝╚═╝  ╚═╝╚═╝  ╚═╝*
00004868                                   444  ***************************************************
00004868                                   445  *
00004868                                   446  **************************************************************************************************************************
00004868                                   447  ***
00004868                                   448  **** Prueba 11: Se realiza la inserción de 2000 caracteres en el buffer interno de transmisión de la linea B(3) llamando ***
00004868                                   449  **** sucesivamente a ESCCAR. A continuación se leen 2000 caracteres de dicho buffer llamando a LEECAR
00004868                                   450  ****
00004868                                   451  **************************************************************************************************************************
00004868                                   452  ***
00004868                                   453  *pr11es_int:
00004868                                   454  *    MOVE.L #2000,D3
00004868                                   455  *    MOVE.L #3,D7
00004868                                   456  *    BSR BUCESNFF
00004868                                   457  *    MOVE.L #3,D7
00004868                                   458  *    MOVE.L #2000,D3
00004868                                   459  *    BSR BUCLEEN
00004868                                   460  *    CMP.L #$CF,D0
00004868                                   461  *    BEQ BIEN
00004868                                   462  *    MOVE.L #-1,D5
00004868                                   463  *    BRA FINC
00004868                                   464  *
00004868                                   465  **************************************************************************************************************************
00004868                                   466  ***
00004868                                   467  **************************************************************************************************************************
00004868                                   468  ***
00004868                                   469  **** Prueba 12: Se realiza la inserción de 1800 caracteres en el buffer interno de recepcion de la linea A(0) llamando ***
00004868                                   470  **** sucesivamente a ESCCAR. A continuación se leen 100 caracteres de dicho buffer llamando a LEECAR y se vuelven a
00004868                                   471  ****
00004868                                   472  **** insertar 300 caracteres.
00004868                                   473  ****
00004868                                   474  **************************************************************************************************************************
00004868                                   475  ***
00004868                                   476  *pr12es_int:
00004868                                   477  *    MOVE.L #1800,D3
00004868                                   478  *    MOVE.L #0,D7
00004868                                   479  *    BSR BUCESNFF
00004868                                   480  *    MOVE.L #0,D7
00004868                                   481  *    MOVE.L #100,D3
00004868                                   482  *    BSR BUCLEEN
00004868                                   483  *    MOVE.L #300,D3
00004868                                   484  *    MOVE.L #0,D7
00004868                                   485  *    BSR BUCESNFF
00004868                                   486  *    BRA COMPCOR
00004868                                   487  *
00004868                                   488  *
00004868                                   489  **************************************************************************************************************************
00004868                                   490  ***
00004868                                   491  **** Prueba 13: Se realiza la inserción de 2000 caracteres en el buffer interno de recepcion de la linea B(1) llamando ***
00004868                                   492  **** sucesivamente a ESCCAR. A continuación se lee 1 caracter de dicho buffer llamando a LEECAR y se vuelven a insertar ***
00004868                                   493  **** 2 caracteres.
00004868                                   494  ****
00004868                                   495  **************************************************************************************************************************
00004868                                   496  ***
00004868                                   497  *pr13es_int:
00004868                                   498  *    MOVE.L #2000,D3
00004868                                   499  *    MOVE.L #1,D7
00004868                                   500  *    BSR BUCESNFF
00004868                                   501  *    MOVE.L #1,D0
00004868                                   502  *    MOVE.L #1,D1
00004868                                   503  *    BSR LEECAR
00004868                                   504  *    MOVE.L #2,D3
00004868                                   505  *    MOVE.L #1,D7
00004868                                   506  *    BSR BUCESNFF
00004868                                   507  *    BRA COMPF
00004868                                   508  *
00004868                                   509  **************************************************************************************************************************
00004868                                   510  ***
00004868                                   511  **** Prueba 14: Se realiza la inserción de 2000 caracteres en el buffer interno de transmisión de la linea A(2) llamando ***
00004868                                   512  **** sucesivamente a ESCCAR. A continuación se lee 10 caracteres de dicho buffer llamando a LEECAR y se vuelven a
00004868                                   513  ****
00004868                                   514  **** insertar 10 caracteres y por último se vuelven a leer 2000.
00004868                                   515  ****
00004868                                   516  **************************************************************************************************************************
00004868                                   517  ***
00004868                                   518  *pr14es_int:
00004868                                   519  *    MOVE.L #2000,D3
00004868                                   520  *    MOVE.L #2,D7
00004868                                   521  *    BSR BUCESNFF
00004868                                   522  *    MOVE.L #2,D7
00004868                                   523  *    MOVE.L #10,D3
00004868                                   524  *    BSR BUCLEEN
00004868                                   525  *    MOVE.L #10,D3
00004868                                   526  *    MOVE.L #2,D7
00004868                                   527  *    BSR BUCESNFF
00004868                                   528  *    MOVE.L #2,D7
00004868                                   529  *    MOVE.L #2000,D3
00004868                                   530  *    BSR BUCLEEN
00004868                                   531  *    CMP.L #$9,D0
00004868                                   532  *    BEQ BIEN
00004868                                   533  *    MOVE.L #-1,D5
00004868                                   534  *    BRA FINC
00004868                                   535  *
00004868                                   536  **************************************************************************************************************************
00004868                                   537  ***
00004868                                   538  **** Prueba 15: Se realiza la inserción de 2000 caracteres en el buffer interno de transmisión de la linea B(3) llamando ***
00004868                                   539  **** sucesivamente a ESCCAR. A continuación se leen 1000 caracteres de dicho buffer llamando a LEECAR y se vuelven a ***
00004868                                   540  **** insertar 1000 caracteres y por último se vuelven a leer 1500.
00004868                                   541  ****
00004868                                   542  **************************************************************************************************************************
00004868                                   543  ***
00004868                                   544  *pr15es_int:
00004868                                   545  *    MOVE.L #2000,D3
00004868                                   546  *    MOVE.L #3,D7
00004868                                   547  *    BSR BUCESNFF
00004868                                   548  *    MOVE.L #3,D7
00004868                                   549  *    MOVE.L #1000,D3
00004868                                   550  *    BSR BUCLEEN
00004868                                   551  *    MOVE.L #1000,D3
00004868                                   552  *    MOVE.L #3,D7
00004868                                   553  *    BSR BUCESNFF
00004868                                   554  *    MOVE.L #3,D7
00004868                                   555  *    MOVE.L #1500,D3
00004868                                   556  *    BSR BUCLEEN
00004868                                   557  *    CMP.L #$F3,D0
00004868                                   558  *    BEQ BIEN
00004868                                   559  *    MOVE.L #-1,D5
00004868                                   560  *    BRA FINC
00004868                                   561  *
00004868                                   562  **********************************************************
00004868                                   563  ** █████╗ ██╗   ██╗██╗  ██╗██╗██╗     ██╗ █████╗ ██████╗ *
00004868                                   564  **██╔══██╗██║   ██║╚██╗██╔╝██║██║     ██║██╔══██╗██╔══██╗*
00004868                                   565  **███████║██║   ██║ ╚███╔╝ ██║██║     ██║███████║██████╔╝*
00004868                                   566  **██╔══██║██║   ██║ ██╔██╗ ██║██║     ██║██╔══██║██╔══██╗*
00004868                                   567  **██║  ██║╚██████╔╝██╔╝ ██╗██║███████╗██║██║  ██║██║  ██║*
00004868                                   568  **╚═╝  ╚═╝ ╚═════╝ ╚═╝  ╚═╝╚═╝╚══════╝╚═╝╚═╝  ╚═╝╚═╝  ╚═╝*
00004868                                   569  *********************************************************
00004868                                   570  *                                                       
00004868                                   571  **************************************************************************************************************************
00004868                                   572  ******
00004868                                   573  **** Funcionamiento de los bucles:
00004868                                   574  ****
00004868                                   575  **** -D7 es el buffer que queremos usar: D7={0,1,2,3}, por lo tanto hay que hacer un MOVE.L #X,D7, donde x es el buffer ***
00004868                                   576  **** -La variable n es D3, por lo tanto si queremos meter 200 numeros por ejemplo hay que hacer MOVE.L #200,D3
00004868                                   577  ****
00004868                                   578  **************************************************************************************************************************
00004868                                   579  ******
00004868                                   580  **************************************************************************************************************************
00004868                                   581  ******
00004868                                   582  **** Este bucle llama a ESCCAR n veces rellenando el buffer todo con unos
00004868                                   583  ****
00004868                                   584  *BUCESN1S:
00004868                                   585  *    EOR D4,D4 *Contador de elementos
00004868                                   586  *    buc1:
00004868                                   587  *        MOVE.L #1,D1 *Variable 1 que queremos meter en el buffer n veces
00004868                                   588  *        MOVE.L D7,D0
00004868                                   589  *        BSR ESCCAR
00004868                                   590  *        ADD.L #1,D4
00004868                                   591  *        CMP.L D3,D4
00004868                                   592  *        BNE buc1
00004868                                   593  *    RTS
00004868                                   594  *
00004868                                   595  *
00004868                                   596  *
00004868                                   597  **************************************************************************************************************************
00004868                                   598  ******
00004868                                   599  **************************************************************************************************************************
00004868                                   600  ******
00004868                                   601  **** Este bucle llama a ESCCAR n veces rellenando el buffer todo con números desde 0 al FF en hexadecimal
00004868                                   602  ****
00004868                                   603  *BUCESNFF:
00004868                                   604  *    EOR D4,D4
00004868                                   605  *    EOR D1,D1
00004868                                   606  *    buc2:
00004868                                   607  *        MOVE.L D7,D0
00004868                                   608  *        BSR ESCCAR
00004868                                   609  *        ADD.L #1,D4
00004868                                   610  *        ADD.L #1,D1
00004868                                   611  *        CMP.L #$100,D1
00004868                                   612  *        BEQ D1ZERO
00004868                                   613  *        BRA FINB1
00004868                                   614  *        D1ZERO: EOR D1,D1
00004868                                   615  *        FINB1: CMP.L D3,D4
00004868                                   616  *        BNE buc2
00004868                                   617  *    RTS
00004868                                   618  *
00004868                                   619  *
00004868                                   620  *
00004868                                   621  *
00004868                                   622  **************************************************************************************************************************
00004868                                   623  ******
00004868                                   624  **************************************************************************************************************************
00004868                                   625  ******
00004868                                   626  **** Este bucle llama a ESCCAR n veces rellenando el buffer todo con números desde 0 al 9 en hexadecimal
00004868                                   627  ****
00004868                                   628  *BUCESN09:
00004868                                   629  *    EOR D4,D4
00004868                                   630  *    EOR D1,D1
00004868                                   631  *    buc4:
00004868                                   632  *        MOVE.L D7,D0
00004868                                   633  *        BSR ESCCAR
00004868                                   634  *        ADD.L #1,D4
00004868                                   635  *        ADD.L #1,D1
00004868                                   636  *        CMP.L #10,D1
00004868                                   637  *        BEQ D1ZERO2
00004868                                   638  *        BRA FINB12
00004868                                   639  *        D1ZERO2: EOR D1,D1
00004868                                   640  *        FINB12: CMP.L D3,D4
00004868                                   641  *        BNE buc4
00004868                                   642  *    RTS
00004868                                   643  *
00004868                                   644  *
00004868                                   645  **************************************************************************************************************************
00004868                                   646  **** Este bucle llama a LEECAR n veces
00004868                                   647  ****
00004868                                   648  *BUCLEEN:
00004868                                   649  *    EOR D4,D4
00004868                                   650  *    buc3:
00004868                                   651  *        MOVE.L D7,D0
00004868                                   652  *        BSR LEECAR
00004868                                   653  *        ADD.L #1,D4
00004868                                   654  *        CMP.L D3,D4
00004868                                   655  *        BNE buc3
00004868                                   656  *    RTS
00004868                                   657  *
00004868                                   658  *COMPCOR: CMP.L #0,D0
00004868                                   659  *    BEQ BIEN
00004868                                   660  *    BRA MAL
00004868                                   661  *
00004868                                   662  *COMPF: CMP #-1,D0
00004868                                   663  *    BEQ BIEN
00004868                                   664  *    BRA MAL
00004868                                   665  *
00004868                                   666  *BIEN: MOVE.L #$abcdef10,D5
00004868                                   667  *    BRA FINC
00004868                                   668  *
00004868                                   669  *MAL: MOVE.L #-1,D5
00004868                                   670  *
00004868                                   671  *FINC: BREAK
00004868                                   672  *
00004868                                   673  *
00004868                                   674  ** Given by guide
00004868                                   675  **
00004868                                   676  **INICIO: * Manejadores de excepciones
00004868                                   677  **    MOVE.L  #BUS_ERROR,8     * Bus error handler
00004868                                   678  **    MOVE.L  #ADDRESS_ER,12   * Address error handler
00004868                                   679  **    MOVE.L  #ILLEGAL_IN,16   * Illegal instruction handler
00004868                                   680  **    MOVE.L  #PRIV_VIOLT,32   * Privilege Violation handler
00004868                                   681  **
00004868                                   682  **    BSR     INIT
00004868                                   683  **    MOVE.W  #$2000,SR        * Permite interrupciones
00004868                                   684  **
00004868                                   685  **BUCPR:
00004868                                   686  **    MOVE.W  #0,CONTC         * Inicializa contador de caracteres
00004868                                   687  **    MOVE.W  #NLIN,CONTL      * Inicializa contador de lineas
00004868                                   688  **    MOVE.L  #BUFFER,DIRLEC   * Direccion de lectura = comienzo del buffer
00004868                                   689  **
00004868                                   690  **OTRAL:
00004868                                   691  **    MOVE.W  #TAML,-(A7)      * Tamano maximo de la linea
00004868                                   692  **    MOVE.W  #DESB,-(A7)      * Puerto A
00004868                                   693  **    MOVE.L  DIRLEC,-(A7)     * Direccion de lectura
00004868                                   694  **
00004868                                   695  **ESPL:
00004868                                   696  **    BSR     SCAN
00004868                                   697  **    CMP.L   #0,D0
00004868                                   698  **    BEQ     ESPL             * Si no se ha leido la linea, se intenta de nuevo
00004868                                   699  **    ADD.L   #8,A7            * Reestablece la pila
00004868                                   700  **    ADD.L   D0,DIRLEC        * Calcula la nueva direccion de lectura
00004868                                   701  **    ADD.W   D0,CONTC         * Actualiza el contador de caracteres
00004868                                   702  **
00004868                                   703  **    SUB.W   #1,CONTL         * Actualiza el numero de lineas leidas.
00004868                                   704  **    BNE     OTRAL            * Si no se han leido todas, se vuelve a leer
00004868                                   705  **
00004868                                   706  **    MOVE.L  #BUFFER,DIRLEC   * DIreccion de lectura = comienzo del buffer
00004868                                   707  **
00004868                                   708  **OTRAE:
00004868                                   709  **    MOVE.W  #TAMB,TAME       * Tamano de escritura = tamano de bloque
00004868                                   710  **
00004868                                   711  **ESPE:
00004868                                   712  **    MOVE.W  TAME,-(A7)       * Tamano de escritura
00004868                                   713  **        MOVE.W  #DESA,-(A7)      * Puerto B
00004868                                   714  **        MOVE.L  DIRLEC,-(A7)     * Direccion de lectura
00004868                                   715  **    * BREAK
00004868                                   716  **    BSR     PRINT
00004868                                   717  **    ADD.L   #8,A7            * Reestablece la pila
00004868                                   718  **    ADD.L   D0,DIRLEC        * Calcula la nueva direccion del buffer
00004868                                   719  **    SUB.W   D0,CONTC         * Actualiza el contador de caracteres
00004868                                   720  **    BEQ     SALIR            * Si no quedan caracteres, se acaba
00004868                                   721  **    SUB.W   D0,TAME          * Actualiza el tamano de escritura
00004868                                   722  **    BNE     ESPE             * Si no se ha escrito todo el bloque, se insiste
00004868                                   723  **    CMP.W   #TAMB,CONTC      * Si el numero de caracteres restantes es menor que el establecido, se transmite ese numero
00004868                                   724  **    BHI     OTRAE            * Siguiente bloque
00004868                                   725  **    MOVE.W  CONTC,TAME
00004868                                   726  **    BRA     ESPE             * Siguiente bloque
00004868                                   727  **
00004868                                   728  **SALIR:
00004868                                   729  **    BRA     BUCPR
00004868                                   730  **
00004868                                   731  **FIN:
00004868                                   732  **    BREAK
00004868                                   733  **
00004868                                   734  **BUS_ERROR:
00004868                                   735  **    BREAK                    * Bus error handler
00004868                                   736  **    NOP
00004868                                   737  **
00004868                                   738  **ADDRESS_ER:
00004868                                   739  **    BREAK                    * Address error handler
00004868                                   740  **    NOP
00004868                                   741  **
00004868                                   742  **ILLEGAL_IN:
00004868                                   743  **    BREAK                    * Illegal instruction handler
00004868                                   744  **    NOP
00004868                                   745  **
00004868                                   746  **PRIV_VIOLT:
00004868                                   747  **    BREAK                    * Priviledge violation handler
00004868                                   748  **    NOP
00004868                                   749  **
00004868                                   750  
00004868                                   751  BUS_ERROR:
00004868  4848                             752      BREAK                    * Bus error handler
0000486A  4E71                             753      NOP
0000486C                                   754  
0000486C                                   755  ADDRESS_ER:
0000486C  4848                             756      BREAK                    * Address error handler
0000486E  4E71                             757      NOP
00004870                                   758  
00004870                                   759  ILLEGAL_IN:
00004870  4848                             760      BREAK                    * Illegal instruction handler
00004872  4E71                             761      NOP
00004874                                   762  
00004874                                   763  PRIV_VIOLT:
00004874  4848                             764      BREAK                    * Priviledge violation handler
00004876  4E71                             765      NOP

No errors detected
No warnings generated
