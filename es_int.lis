00000000                                     1      ORG $0
00000000  00008000                           2      DC.L $8000 * Valor inicial del puntero de pila
00000004  0000254A                           3      DC.L PPAL * Direccion RTI de la interrupcion Reset, etiqueta del programa ppal
00000008                                     4  
00000400                                     5      ORG $400
00000400                                     6  
00000400                                     7  * Almacen de buffers
00000400                                     8  
00000400  =000007D1                          9  SIZE EQU 2001                   * Size de los buffers
00000400                                    10  
00000400  00000000 00000000 00000000 ...    11      BUFF_V:     DC.L    0,0,0,0     * Punteros a los buffers
00000410                                    12  
00000410                                    13  * extraccion, insercion, pos inicial, pos final 
00000410  00000000 00000000 00000000 ...    14      BUFF_0:     DC.L    0,0,0,0     * Buffer 0 -> Recepcion A
00000420                                    15                  DS.B    SIZE
00000BF1                                    16  
00000BF2  00000000 00000000 00000000 ...    17      BUFF_1:     DC.L    0,0,0,0     * Buffer 1 -> Recepcion B
00000C02                                    18                  DS.B    SIZE
000013D3                                    19  
000013D4  00000000 00000000 00000000 ...    20      BUFF_2:     DC.L    0,0,0,0     * Buffer 2 -> Transmision A
000013E4                                    21                  DS.B    SIZE
00001BB5                                    22  
00001BB6  00000000 00000000 00000000 ...    23      BUFF_3:     DC.L    0,0,0,0     * Buffer 3 -> Transmision B
00001BC6                                    24                  DS.B    SIZE
00002397                                    25  
00002397                                    26      IMRCOPY:    DS.B    1            * Copia de IMR ya que no puede ser leido
00002398                                    27  
00002398                                    28  * Registros de la DUART MC68681
00002398                                    29  
00002398  =00EFFC01                         30  MR1A	EQU		$EFFC01
00002398  =00EFFC01                         31  MR2A	EQU		$EFFC01
00002398  =00EFFC03                         32  SRA		EQU		$EFFC03
00002398  =00EFFC03                         33  CSRA	EQU		$EFFC03
00002398  =00EFFC05                         34  CRA		EQU		$EFFC05
00002398  =00EFFC07                         35  TBA		EQU		$EFFC07
00002398  =00EFFC07                         36  RBA		EQU		$EFFC07
00002398                                    37  
00002398  =00EFFC09                         38  ACR		EQU		$EFFC09
00002398  =00EFFC0B                         39  IMR		EQU		$EFFC0B
00002398  =00EFFC0B                         40  ISR		EQU		$EFFC0B
00002398                                    41  
00002398  =00EFFC11                         42  MR1B	EQU		$EFFC11
00002398  =00EFFC11                         43  MR2B	EQU		$EFFC11
00002398  =00EFFC15                         44  CRB     EQU     $effc15
00002398  =00EFFC17                         45  TBB     EQU     $effc17
00002398  =00EFFC17                         46  RBB     EQU     $effc17
00002398                                    47  
00002398  =00EFFC13                         48  SRB     EQU     $effc13
00002398  =00EFFC13                         49  CSRB    EQU     $effc13
00002398  =00EFFC19                         50  IVR		EQU		$EFFC19
00002398                                    51  
00002398                                    52  
00002398                                    53  
00002398                                    54  
00002398                                    55  
00002398                                    56      
00002398                                    57      INIT:
00002398                                    58          * Preparación de periféricos
00002398  13FC 0010 00EFFC05                59                  MOVE.B    #%00010000,CRA        * Reinicia el puntero MR1
000023A0  13FC 0003 00EFFC01                60                  MOVE.B    #%00000011,MR1A       * 8 bits por caracter (interrumpe cada 8 bits)
000023A8  13FC 0000 00EFFC01                61                  MOVE.B    #%00000000,MR2A       * Eco desactivado
000023B0  13FC 00CC 00EFFC03                62                  MOVE.B    #%11001100,CSRA       * Velocidad = 38400 bps
000023B8                                    63  
000023B8  13FC 0010 00EFFC15                64                  MOVE.B    #%00010000,CRB        * Reinicia el puntero MR1
000023C0  13FC 0003 00EFFC11                65                  MOVE.B    #%00000011,MR1B       * 8 bits por caracter (interrumpe cada 8 bits)
000023C8  13FC 0000 00EFFC11                66                  MOVE.B    #%00000000,MR2B       * Eco desactivado
000023D0  13FC 00CC 00EFFC13                67                  MOVE.B    #%11001100,CSRB       * Velocidad = 38400 bps
000023D8                                    68  
000023D8  13FC 0000 00EFFC09                69                  MOVE.B    #%00000000,ACR        * Velocidad = 38400 bps
000023E0  13FC 0005 00EFFC05                70                  MOVE.B    #%00000101,CRA        * Transmision y recepcion activados
000023E8  13FC 0005 00EFFC15                71                  MOVE.B    #%00000101,CRB        * Transmision y recepcion activados
000023F0                                    72  
000023F0  11FC 0022 2397                    73                  MOVE.B    #%00100010,IMRCOPY    * Copiar IMR en nuestra propia variable
000023F6  13F8 2397 00EFFC0B                74                  MOVE.B    IMRCOPY,IMR
000023FE                                    75  
000023FE  21FC 00002548 0100                76                  MOVE.L    #RTI,$100             * Decimal: 4*64 = 256 -> Hexa: 100
00002406  13FC 0040 00EFFC19                77                  MOVE.B    #$40,IVR              * Vector de interrupcion = 64
0000240E                                    78  
0000240E                                    79  
0000240E                                    80                  * Mis propios inits
0000240E                                    81  
0000240E  207C 00000400                     82                  MOVE.L    #BUFF_V,A0            * Vector de buffers 
00002414                                    83  
00002414  20BC 00000410                     84                  MOVE.L    #BUFF_0,(A0)          * Buffer recepcion A
0000241A  217C 00000BF2 0004                85                  MOVE.L    #BUFF_1,4(A0)         * Buffer recepcion B
00002422  217C 000013D4 0008                86                  MOVE.L    #BUFF_2,8(A0)         * Buffer transmision A
0000242A  217C 00001BB6 000C                87                  MOVE.L    #BUFF_3,12(A0)        * Buffer transmision B
00002432                                    88  
00002432  207C 00000410                     89                  MOVE.L    #BUFF_0,A0
00002438  20BC 00000420                     90                  MOVE.L    #BUFF_0+16,(A0)
0000243E  217C 00000420 0004                91                  MOVE.L    #BUFF_0+16,4(A0)
00002446  217C 00000420 0008                92                  MOVE.L    #BUFF_0+16,8(A0)
0000244E  217C 00000BF1 000C                93                  MOVE.L    #BUFF_0+SIZE+16,12(A0)
00002456                                    94  
00002456  207C 00000BF2                     95                  MOVE.L    #BUFF_1,A0
0000245C  20BC 00000C02                     96                  MOVE.L    #BUFF_1+16,(A0)
00002462  217C 00000C02 0004                97                  MOVE.L    #BUFF_1+16,4(A0)
0000246A  217C 00000C02 0008                98                  MOVE.L    #BUFF_1+16,8(A0)
00002472  217C 000013D3 000C                99                  MOVE.L    #BUFF_1+SIZE+16,12(A0)
0000247A                                   100  
0000247A  207C 000013D4                    101                  MOVE.L    #BUFF_2,A0
00002480  20BC 000013E4                    102                  MOVE.L    #BUFF_2+16,(A0)
00002486  217C 000013E4 0004               103                  MOVE.L    #BUFF_2+16,4(A0)
0000248E  217C 000013E4 0008               104                  MOVE.L    #BUFF_2+16,8(A0)
00002496  217C 00001BB5 000C               105                  MOVE.L    #BUFF_2+SIZE+16,12(A0)
0000249E                                   106  
0000249E  207C 00001BB6                    107                  MOVE.L    #BUFF_3,A0
000024A4  20BC 00001BC6                    108                  MOVE.L    #BUFF_3+16,(A0)
000024AA  217C 00001BC6 0004               109                  MOVE.L    #BUFF_3+16,4(A0)
000024B2  217C 00001BC6 0008               110                  MOVE.L    #BUFF_3+16,8(A0)
000024BA  217C 00002397 000C               111                  MOVE.L    #BUFF_3+SIZE+16,12(A0)
000024C2                                   112  
000024C2                                   113  
000024C2  4E75                             114                  RTS
000024C4                                   115  
000024C4                                   116  
000024C4                                   117  
000024C4                                   118  
000024C4                                   119  
000024C4  48E7 00E0                        120      LEECAR:     MOVEM.L A0-A2,-(A7)
000024C8  C0BC 00000003                    121                  AND.L   #$3,D0
000024CE  E580                             122                  ASL.L   #2,D0           * Get buffer seleccionado
000024D0  307C 0400                        123                  MOVE    #BUFF_V,A0      * Get vector de buffers
000024D4  2070 0000                        124                  MOVE.L  (A0,D0),A0      * Get buffer concreto
000024D8  2250                             125                  MOVE.L  (A0),A1         * Get puntero de extraccion en A1
000024DA  2468 0004                        126                  MOVE.L  4(A0),A2        * Get puntero de insericon en A2
000024DE                                   127  
000024DE  B180                             128                  EOR.L   D0,D0           * D0 = 0
000024E0  B5C9                             129                  CMP.L   A1,A2           * Si extraccion e insercion son iguales -> empty buffer
000024E2  6700 001C                        130                  BEQ     EMPTY
000024E6                                   131  
000024E6  1019                             132                  MOVE.B  (A1)+,D0        * Leo e incremento puntero
000024E8  B3E8 000C                        133                  CMP.L   12(A0),A1       * Si pos_final == p_extraccion -> final del buffer
000024EC  6700 0008                        134                  BEQ     E_RES
000024F0                                   135  
000024F0  2089                             136                  MOVE.L  A1,(A0)         * Actualizo puntero de extraccion
000024F2  6000 000E                        137                  BRA     LC_END
000024F6                                   138  
000024F6  2268 0008                        139      E_RES:      MOVE.L  8(A0),A1        * Extraccion reset
000024FA  2089                             140                  MOVE.L  A1,(A0)
000024FC  6000 0004                        141                  BRA     LC_END
00002500                                   142  
00002500  70FF                             143      EMPTY:      MOVE.L  #-1,D0          * Empty buffer
00002502                                   144  
00002502  4CDF 0700                        145      LC_END:     MOVEM.L (A7)+,A0-A2     * Fin leecar
00002506  4E75                             146                  RTS
00002508                                   147  
00002508                                   148  
00002508                                   149  
00002508                                   150  
00002508  48E7 00E0                        151      ESCCAR:     MOVEM.L A0-A2,-(A7)
0000250C  C0BC 00000003                    152                  AND.L   #$3,D0
00002512  E580                             153                  ASL.L   #2,D0           * Get buffer seleccionado
00002514  307C 0400                        154                  MOVE    #BUFF_V,A0      * Get vector de buffers
00002518  2070 0000                        155                  MOVE.L  (A0,D0),A0      * Get buffer concreto
0000251C  2250                             156                  MOVE.L  (A0),A1         * Get puntero de extraccion en A1
0000251E  2468 0004                        157                  MOVE.L  4(A0),A2        * Get puntero de insercion en A2
00002522                                   158  
00002522  14C1                             159                  MOVE.B  D1,(A2)+        * Insert caracter
00002524  B5E8 000C                        160                  CMP.L   12(A0),A2       * Si pos_final == p_insercion -> final del buffer
00002528  6600 0006                        161                  BNE     N_RES           * Si no esta en el final del buffer, continua en N_RES
0000252C                                   162  
0000252C  2468 0008                        163                  MOVE.L  8(A0),A2        * Reset del p_insercion
00002530                                   164  
00002530  B5C9                             165      N_RES:      CMP.L   A1,A2           * Si extraccion == insercion -> buffer full
00002532  6700 000C                        166                  BEQ     FULL
00002536                                   167                  * No esta lleno
00002536  214A 0004                        168                  MOVE.L  A2,4(A0)
0000253A  7000                             169                  MOVE.L  #0,D0
0000253C  6000 0004                        170                  BRA     FINEC
00002540                                   171  
00002540  70FF                             172      FULL:       MOVE.L  #-1,D0
00002542                                   173  
00002542  4CDF 0700                        174      FINEC:      MOVEM.L (A7)+,A0-A2
00002546  4E75                             175                  RTS
00002548                                   176  
00002548                                   177  
00002548  4E73                             178      RTI:        RTE
0000254A                                   179  
0000254A                                   180  
0000254A                                   181  
0000254A                                   182  *	PPAL:		MOVE.L #BUS_ERROR,8 * Bus error handler
0000254A                                   183  *				MOVE.L #ADDRESS_ER,12 * Address error handler
0000254A                                   184  *				MOVE.L #ILLEGAL_IN,16 * Illegal instruction handler
0000254A                                   185  *				MOVE.L #PRIV_VIOLT,32 * Privilege violation handler
0000254A                                   186  *				MOVE.L #ILLEGAL_IN,40 * Illegal instruction handler
0000254A                                   187  *				MOVE.L #ILLEGAL_IN,44 * Illegal instruction handler
0000254A                                   188  *				
0000254A                                   189  *				BSR INIT
0000254A                                   190  *				
0000254A                                   191  *				MOVE.L 	#1,D0	*D0=1 (Rx Línea B)
0000254A                                   192  *				MOVE.B  #$41,D1
0000254A                                   193  *				BSR 	ESCCAR
0000254A                                   194  *				
0000254A                                   195  *				MOVE.L 	#1,D0
0000254A                                   196  *				BSR 	LEECAR	*Si todo va bien, en D0 deberíamos tener $41
0000254A                                   197  *				
0000254A                                   198  *				MOVE.L 	#2002,D2
0000254A                                   199  *	BUCLE:		MOVE.L 	#1,D0	*D0=1 (Rx Línea B)
0000254A                                   200  *				MOVE.B  #$41,D1
0000254A                                   201  *				BSR 	ESCCAR
0000254A                                   202  *				SUB.L 	#1,D2	
0000254A                                   203  *				CMP.L 	#0,D2
0000254A                                   204  *				BNE		BUCLE	*Cuando salga del bucle, el valor de D0 debería ser -1, pq ya está lleno el buffer
0000254A                                   205  *				
0000254A                                   206  *	BUS_ERROR: 	BREAK * Bus error handler
0000254A                                   207  *				NOP
0000254A                                   208  *	ADDRESS_ER: BREAK * Address error handler
0000254A                                   209  *				NOP
0000254A                                   210  *	ILLEGAL_IN: BREAK * Illegal instruction handler
0000254A                                   211  *				NOP
0000254A                                   212  *	PRIV_VIOLT: BREAK * Privilege violation handler
0000254A                                   213  *				NOP
0000254A                                   214  				
0000254A                                   215  
0000254A                                   216  PPAL: * Manejadores de excepciones
0000254A  21FC 00002640 0008               217      MOVE.L  #BUS_ERROR,8     * Bus error handler
00002552  21FC 00002644 000C               218      MOVE.L  #ADDRESS_ER,12   * Address error handler
0000255A  21FC 00002648 0010               219      MOVE.L  #ILLEGAL_IN,16   * Illegal instruction handler
00002562  21FC 0000264C 0020               220      MOVE.L  #PRIV_VIOLT,32   * Privilege Violation handler
0000256A                                   221  
0000256A  6100 FE2C                        222      BSR     INIT
0000256E                                   223  *
0000256E                                   224  *
0000256E                                   225  ***************************************************
0000256E                                   226  **██╗     ███████╗███████╗ ██████╗ █████╗ ██████╗ *
0000256E                                   227  **██║     ██╔════╝██╔════╝██╔════╝██╔══██╗██╔══██╗*
0000256E                                   228  **██║     █████╗  █████╗  ██║     ███████║██████╔╝*
0000256E                                   229  **██║     ██╔══╝  ██╔══╝  ██║     ██╔══██║██╔══██╗*
0000256E                                   230  **███████╗███████╗███████╗╚██████╗██║  ██║██║  ██║*
0000256E                                   231  **╚══════╝╚══════╝╚══════╝ ╚═════╝╚═╝  ╚═╝╚═╝  ╚═╝*
0000256E                                   232  **************************************************
0000256E                                   233  
0000256E                                   234  *** Prueba 2: Llamada a ESCCAR introduciendo un caracter en el buffer de recepción de la línea A (0)
0000256E                                   235  ***
0000256E                                   236  *************************************************************************************************************************
0000256E                                   237  **
0000256E                                   238  *pr02es_int:
0000256E                                   239  *    MOVE.L #0,D0
0000256E                                   240  *    MOVE.L #1,D1
0000256E                                   241  *    BSR ESCCAR      * D0 tiene que ser 0
0000256E                                   242      *BRA COMPCOR
0000256E                                   243  *************************************************************************************************************************
0000256E                                   244  **
0000256E                                   245  *** Prueba 3: Se escriben 10 caracteres en el buffer de recepción de la linea B(1) (10 llamadas a ESCCAR).
0000256E                                   246  ***
0000256E                                   247  *************************************************************************************************************************
0000256E                                   248  **
0000256E                                   249  *pr03es_int:
0000256E                                   250  *    MOVE.L #10,D3
0000256E                                   251  *    MOVE.L #1,D7
0000256E                                   252  *    BSR BUCESN1S
0000256E                                   253      *BRA COMPCOR    * D0 tiene que ser 0
0000256E                                   254  *************************************************************************************************************************
0000256E                                   255  **
0000256E                                   256  *** Prueba 4: Se escriben 300 caracteresen el buffer de transmisión de la linea A (2) (300 llamadas a ESCCAR).
0000256E                                   257  ***
0000256E                                   258  *************************************************************************************************************************
0000256E                                   259  **
0000256E                                   260  *pr04es_int:
0000256E                                   261  *    MOVE.L #2,D7
0000256E                                   262  *    MOVE.L #300,D3
0000256E                                   263  *    BSR BUCESNFF
0000256E                                   264      *BRA COMPCOR    * D0 tiene que ser 0
0000256E                                   265  
0000256E                                   266  *************************************************************************************************************************
0000256E                                   267  **
0000256E                                   268  *** Prueba 5: Se escriben 2000 caracteresen el buffer de transmisión de la linea B (3) (2000 llamadas a ESCCAR).
0000256E                                   269  ***
0000256E                                   270  *************************************************************************************************************************
0000256E                                   271  **
0000256E                                   272  *pr05es_int:
0000256E                                   273  *    MOVE.L #2000,D3
0000256E                                   274  *    MOVE.L #3,D7
0000256E                                   275  *    BSR BUCESNFF
0000256E                                   276      *BRA COMPCOR    * D0 tiene que ser 0
0000256E                                   277  *************************************************************************************************************************
0000256E                                   278  **
0000256E                                   279  *** Prueba 6: Se escriben más de 2000 caracteresen el buffer de transmisión de la linea B (3) (2001 llamadas a ESCCAR). ***
0000256E                                   280  *************************************************************************************************************************
0000256E                                   281  **
0000256E                                   282  *pr06es_int:
0000256E                                   283  *    MOVE.L #2000,D3
0000256E                                   284  *    MOVE.L #3,D7
0000256E                                   285  *    BSR BUCESNFF
0000256E                                   286  *    MOVE.L #3,D0
0000256E                                   287  *    MOVE.L #11,D1 * caracter 2001
0000256E                                   288  *    BSR ESCCAR
0000256E                                   289  *    *BRA COMPF      * D0 tiene que ser -1
0000256E                                   290  *************************************************************************************************************************
0000256E                                   291  **
0000256E                                   292  *** Prueba 7: Se prueba a leer un caracter de un buffer vacío (LEECAR buffer recepcion línea A)
0000256E                                   293  *****
0000256E                                   294  *************************************************************************************************************************
0000256E                                   295  **
0000256E                                   296  *pr07es_int:
0000256E                                   297  *    MOVE.L #0,D0
0000256E                                   298  *    BSR LEECAR
0000256E                                   299      *BRA COMPF      * D0 tiene que ser -1 
0000256E                                   300  *************************************************************************************************************************
0000256E                                   301  **
0000256E                                   302  
0000256E                                   303  
0000256E                                   304  *** Prueba 8: Se prueba a leer un caracter con 200 escritos en el buffer (LEECAR buffer recepcion línea A(0))
0000256E                                   305  ***
0000256E                                   306  *************************************************************************************************************************
0000256E                                   307  **
0000256E                                   308  *pr08es_int:
0000256E                                   309  *    MOVE.L #200,D3
0000256E                                   310  *    MOVE.L #0,D7
0000256E                                   311  *    BSR BUCESNFF
0000256E                                   312  *    MOVE.L #0,D0
0000256E                                   313  *    BSR LEECAR
0000256E                                   314  *    CMP.L #0,D0
0000256E                                   315  *    BEQ BIEN
0000256E                                   316  *    MOVE.L #-1,D5
0000256E                                   317  *    BRA FINC
0000256E                                   318  *************************************************************************************************************************
0000256E                                   319  **
0000256E                                   320  *** Prueba 9: Se prueba a leer 10 caracteres con 300 escritos en el buffer (LEECAR buffer recepcion línea B(1))
0000256E                                   321  ***
0000256E                                   322  *************************************************************************************************************************
0000256E                                   323  **
0000256E                                   324  *pr09es_int:
0000256E                                   325  *    MOVE.L #200,D3
0000256E                                   326  *    MOVE.L #1,D7
0000256E                                   327  *    BSR BUCESNFF
0000256E                                   328  *    MOVE.L #1,D7
0000256E                                   329  *    MOVE.L #10,D3
0000256E                                   330  *    BSR BUCLEEN
0000256E                                   331  *    CMP.L #$9,D0
0000256E                                   332  *    BEQ BIEN
0000256E                                   333  *    MOVE.L #-1,D5
0000256E                                   334  *    BRA FINC
0000256E                                   335  
0000256E                                   336  *************************************************************************************************************************
0000256E                                   337  **
0000256E                                   338  *** Prueba 10: Se prueba a leer 300 caracteres con 300 escritos en el buffer (LEECAR buffer transmisión línea A(2)) ***
0000256E                                   339  *************************************************************************************************************************
0000256E                                   340  **
0000256E                                   341  *pr10es_int:
0000256E                                   342  *    MOVE.L #300,D3
0000256E                                   343  *    MOVE.L #2,D7
0000256E                                   344  *    BSR BUCESNFF
0000256E                                   345  *    MOVE.L #2,D7
0000256E                                   346  *    MOVE.L #300,D3
0000256E                                   347  *    BSR BUCLEEN
0000256E                                   348  *    CMP.L #$2B,D0
0000256E                                   349  *    BEQ BIEN
0000256E                                   350  *    MOVE.L #-1,D5
0000256E                                   351  *    BRA FINC
0000256E                                   352  
0000256E                                   353  
0000256E                                   354  **************************************************
0000256E                                   355  *███████╗███████╗ ██████╗ ██████╗ █████╗ ██████╗ *
0000256E                                   356  *██╔════╝██╔════╝██╔════╝██╔════╝██╔══██╗██╔══██╗*
0000256E                                   357  *█████╗  ███████╗██║     ██║     ███████║██████╔╝*
0000256E                                   358  *██╔══╝  ╚════██║██║     ██║     ██╔══██║██╔══██╗*
0000256E                                   359  *███████╗███████║╚██████╗╚██████╗██║  ██║██║  ██║*
0000256E                                   360  *╚══════╝╚══════╝ ╚═════╝ ╚═════╝╚═╝  ╚═╝╚═╝  ╚═╝*
0000256E                                   361  **************************************************
0000256E                                   362  
0000256E                                   363  *************************************************************************************************************************
0000256E                                   364  **
0000256E                                   365  *** Prueba 11: Se realiza la inserción de 2000 caracteres en el buffer interno de transmisión de la linea B(3) llamando ***
0000256E                                   366  *** sucesivamente a ESCCAR. A continuación se leen 2000 caracteres de dicho buffer llamando a LEECAR
0000256E                                   367  ***
0000256E                                   368  *************************************************************************************************************************
0000256E                                   369  **
0000256E                                   370  *pr11es_int:
0000256E                                   371  *    MOVE.L #2000,D3
0000256E                                   372  *    MOVE.L #3,D7
0000256E                                   373  *    BSR BUCESNFF
0000256E                                   374  *    MOVE.L #3,D7
0000256E                                   375  *    MOVE.L #2000,D3
0000256E                                   376  *    BSR BUCLEEN
0000256E                                   377  *    CMP.L #$CF,D0
0000256E                                   378  *    BEQ BIEN
0000256E                                   379  *    MOVE.L #-1,D5
0000256E                                   380  *    BRA FINC
0000256E                                   381  
0000256E                                   382  *************************************************************************************************************************
0000256E                                   383  **
0000256E                                   384  *************************************************************************************************************************
0000256E                                   385  **
0000256E                                   386  *** Prueba 12: Se realiza la inserción de 1800 caracteres en el buffer interno de recepcion de la linea A(0) llamando ***
0000256E                                   387  *** sucesivamente a ESCCAR. A continuación se leen 100 caracteres de dicho buffer llamando a LEECAR y se vuelven a
0000256E                                   388  ***
0000256E                                   389  *** insertar 300 caracteres.
0000256E                                   390  ***
0000256E                                   391  *************************************************************************************************************************
0000256E                                   392  **
0000256E                                   393  *pr12es_int:
0000256E                                   394  *    MOVE.L #1800,D3
0000256E                                   395  *    MOVE.L #0,D7
0000256E                                   396  *    BSR BUCESNFF
0000256E                                   397  *    MOVE.L #0,D7
0000256E                                   398  *    MOVE.L #100,D3
0000256E                                   399  *    BSR BUCLEEN
0000256E                                   400  *    MOVE.L #300,D3
0000256E                                   401  *    MOVE.L #0,D7
0000256E                                   402  *    BSR BUCESNFF
0000256E                                   403      * BRA COMPCOR       *D0 tiene que ser 0
0000256E                                   404  
0000256E                                   405  
0000256E                                   406  *************************************************************************************************************************
0000256E                                   407  **
0000256E                                   408  *** Prueba 13: Se realiza la inserción de 2000 caracteres en el buffer interno de recepcion de la linea B(1) llamando ***
0000256E                                   409  *** sucesivamente a ESCCAR. A continuación se lee 1 caracter de dicho buffer llamando a LEECAR y se vuelven a insertar ***
0000256E                                   410  *** 2 caracteres.
0000256E                                   411  ***
0000256E                                   412  *************************************************************************************************************************
0000256E                                   413  **
0000256E                                   414  *pr13es_int:
0000256E                                   415  *    MOVE.L #2000,D3
0000256E                                   416  *    MOVE.L #1,D7
0000256E                                   417  *    BSR BUCESNFF
0000256E                                   418  *    MOVE.L #1,D0
0000256E                                   419  *    MOVE.L #1,D1
0000256E                                   420  *    BSR LEECAR
0000256E                                   421  *    MOVE.L #2,D3
0000256E                                   422  *    MOVE.L #1,D7
0000256E                                   423  *    BSR BUCESNFF
0000256E                                   424  *    BRA COMPF
0000256E                                   425  
0000256E                                   426  *************************************************************************************************************************
0000256E                                   427  **
0000256E                                   428  *** Prueba 14: Se realiza la inserción de 2000 caracteres en el buffer interno de transmisión de la linea A(2) llamando ***
0000256E                                   429  *** sucesivamente a ESCCAR. A continuación se lee 10 caracteres de dicho buffer llamando a LEECAR y se vuelven a
0000256E                                   430  ***
0000256E                                   431  *** insertar 10 caracteres y por último se vuelven a leer 2000.
0000256E                                   432  ***
0000256E                                   433  *************************************************************************************************************************
0000256E                                   434  **
0000256E                                   435  *pr14es_int:
0000256E                                   436  *    MOVE.L #2000,D3
0000256E                                   437  *    MOVE.L #2,D7
0000256E                                   438  *    BSR BUCESNFF
0000256E                                   439  *    MOVE.L #2,D7
0000256E                                   440  *    MOVE.L #10,D3
0000256E                                   441  *    BSR BUCLEEN
0000256E                                   442  *    MOVE.L #10,D3
0000256E                                   443  *    MOVE.L #2,D7
0000256E                                   444  *    BSR BUCESNFF
0000256E                                   445  *    MOVE.L #2,D7
0000256E                                   446  *    MOVE.L #2000,D3
0000256E                                   447  *    BSR BUCLEEN
0000256E                                   448  *    CMP.L #$9,D0
0000256E                                   449  *    BEQ BIEN
0000256E                                   450  *    MOVE.L #-1,D5
0000256E                                   451  *    BRA FINC
0000256E                                   452  
0000256E                                   453  *************************************************************************************************************************
0000256E                                   454  **
0000256E                                   455  *** Prueba 15: Se realiza la inserción de 2000 caracteres en el buffer interno de transmisión de la linea B(3) llamando ***
0000256E                                   456  *** sucesivamente a ESCCAR. A continuación se leen 1000 caracteres de dicho buffer llamando a LEECAR y se vuelven a ***
0000256E                                   457  *** insertar 1000 caracteres y por último se vuelven a leer 1500.
0000256E                                   458  ***
0000256E                                   459  *************************************************************************************************************************
0000256E                                   460  **
0000256E                                   461  pr15es_int:
0000256E  263C 000007D0                    462      MOVE.L #2000,D3
00002574  7E03                             463      MOVE.L #3,D7
00002576  6100 0048                        464      BSR BUCESNFF
0000257A  7E03                             465      MOVE.L #3,D7
0000257C  263C 000003E8                    466      MOVE.L #1000,D3
00002582  6100 0084                        467      BSR BUCLEEN
00002586  263C 000003E8                    468      MOVE.L #1000,D3
0000258C  7E03                             469      MOVE.L #3,D7
0000258E  6100 0030                        470      BSR BUCESNFF
00002592  7E03                             471      MOVE.L #3,D7
00002594  263C 000005DC                    472      MOVE.L #1500,D3
0000259A  6100 006C                        473      BSR BUCLEEN
0000259E  B0BC 000000F3                    474      CMP.L #$F3,D0
000025A4  6700 008C                        475      BEQ BIEN
000025A8  7AFF                             476      MOVE.L #-1,D5
000025AA  6000 0092                        477      BRA FINC
000025AE                                   478  
000025AE                                   479  *********************************************************
000025AE                                   480  * █████╗ ██╗   ██╗██╗  ██╗██╗██╗     ██╗ █████╗ ██████╗ *
000025AE                                   481  *██╔══██╗██║   ██║╚██╗██╔╝██║██║     ██║██╔══██╗██╔══██╗*
000025AE                                   482  *███████║██║   ██║ ╚███╔╝ ██║██║     ██║███████║██████╔╝*
000025AE                                   483  *██╔══██║██║   ██║ ██╔██╗ ██║██║     ██║██╔══██║██╔══██╗*
000025AE                                   484  *██║  ██║╚██████╔╝██╔╝ ██╗██║███████╗██║██║  ██║██║  ██║*
000025AE                                   485  *╚═╝  ╚═╝ ╚═════╝ ╚═╝  ╚═╝╚═╝╚══════╝╚═╝╚═╝  ╚═╝╚═╝  ╚═╝*
000025AE                                   486  ********************************************************
000025AE                                   487                                                         
000025AE                                   488  *************************************************************************************************************************
000025AE                                   489  *****
000025AE                                   490  *** Funcionamiento de los bucles:
000025AE                                   491  ***
000025AE                                   492  *** -D7 es el buffer que queremos usar: D7={0,1,2,3}, por lo tanto hay que hacer un MOVE.L #X,D7, donde x es el buffer ***
000025AE                                   493  *** -La variable n es D3, por lo tanto si queremos meter 200 numeros por ejemplo hay que hacer MOVE.L #200,D3
000025AE                                   494  ***
000025AE                                   495  *************************************************************************************************************************
000025AE                                   496  *****
000025AE                                   497  *************************************************************************************************************************
000025AE                                   498  *****
000025AE                                   499  *** Este bucle llama a ESCCAR n veces rellenando el buffer todo con unos
000025AE                                   500  ***
000025AE                                   501  BUCESN1S:
000025AE  B944                             502      EOR D4,D4 *Contador de elementos
000025B0                                   503      buc1:
000025B0  7201                             504          MOVE.L #1,D1 *Variable 1 que queremos meter en el buffer n veces
000025B2  2007                             505          MOVE.L D7,D0
000025B4  6100 FF52                        506          BSR ESCCAR
000025B8  5284                             507          ADD.L #1,D4
000025BA  B883                             508          CMP.L D3,D4
000025BC  66F2                             509          BNE buc1
000025BE  4E75                             510      RTS
000025C0                                   511  
000025C0                                   512  
000025C0                                   513  
000025C0                                   514  *************************************************************************************************************************
000025C0                                   515  *****
000025C0                                   516  *************************************************************************************************************************
000025C0                                   517  *****
000025C0                                   518  *** Este bucle llama a ESCCAR n veces rellenando el buffer todo con números desde 0 al FF en hexadecimal
000025C0                                   519  ***
000025C0                                   520  BUCESNFF:
000025C0  B944                             521      EOR D4,D4
000025C2  B341                             522      EOR D1,D1
000025C4                                   523      buc2:
000025C4  2007                             524          MOVE.L D7,D0
000025C6  6100 FF40                        525          BSR ESCCAR
000025CA  5284                             526          ADD.L #1,D4
000025CC  5281                             527          ADD.L #1,D1
000025CE  B2BC 00000100                    528          CMP.L #$100,D1
000025D4  6700 0006                        529          BEQ D1ZERO
000025D8  6000 0004                        530          BRA FINB1
000025DC  B341                             531          D1ZERO: EOR D1,D1
000025DE  B883                             532          FINB1: CMP.L D3,D4
000025E0  66E2                             533          BNE buc2
000025E2  4E75                             534      RTS
000025E4                                   535  
000025E4                                   536  
000025E4                                   537  
000025E4                                   538  
000025E4                                   539  *************************************************************************************************************************
000025E4                                   540  *****
000025E4                                   541  *************************************************************************************************************************
000025E4                                   542  *****
000025E4                                   543  *** Este bucle llama a ESCCAR n veces rellenando el buffer todo con números desde 0 al 9 en hexadecimal
000025E4                                   544  ***
000025E4                                   545  BUCESN09:
000025E4  B944                             546      EOR D4,D4
000025E6  B341                             547      EOR D1,D1
000025E8                                   548      buc4:
000025E8  2007                             549          MOVE.L D7,D0
000025EA  6100 FF1C                        550          BSR ESCCAR
000025EE  5284                             551          ADD.L #1,D4
000025F0  5281                             552          ADD.L #1,D1
000025F2  B2BC 0000000A                    553          CMP.L #10,D1
000025F8  6700 0006                        554          BEQ D1ZERO2
000025FC  6000 0004                        555          BRA FINB12
00002600  B341                             556          D1ZERO2: EOR D1,D1
00002602  B883                             557          FINB12: CMP.L D3,D4
00002604  66E2                             558          BNE buc4
00002606  4E75                             559      RTS
00002608                                   560  
00002608                                   561  
00002608                                   562  *************************************************************************************************************************
00002608                                   563  *** Este bucle llama a LEECAR n veces
00002608                                   564  ***
00002608                                   565  BUCLEEN:
00002608  B944                             566      EOR D4,D4
0000260A                                   567      buc3:
0000260A  2007                             568          MOVE.L D7,D0
0000260C  6100 FEB6                        569          BSR LEECAR
00002610  5284                             570          ADD.L #1,D4
00002612  B883                             571          CMP.L D3,D4
00002614  66F4                             572          BNE buc3
00002616  4E75                             573      RTS
00002618                                   574  
00002618  B0BC 00000000                    575  COMPCOR: CMP.L #0,D0
0000261E  6700 0012                        576      BEQ BIEN
00002622  6000 0018                        577      BRA MAL
00002626                                   578  
00002626  B07C FFFF                        579  COMPF: CMP #-1,D0
0000262A  6700 0006                        580      BEQ BIEN
0000262E  6000 000C                        581      BRA MAL
00002632                                   582  
00002632  2A3C ABCDEF10                    583  BIEN: MOVE.L #$abcdef10,D5
00002638  6000 0004                        584      BRA FINC
0000263C                                   585  
0000263C  7AFF                             586  MAL: MOVE.L #-1,D5
0000263E                                   587  
0000263E  4848                             588  FINC: BREAK
00002640                                   589  
00002640                                   590  
00002640                                   591  ** Given by guide
00002640                                   592  **
00002640                                   593  **INICIO: * Manejadores de excepciones
00002640                                   594  **    MOVE.L  #BUS_ERROR,8     * Bus error handler
00002640                                   595  **    MOVE.L  #ADDRESS_ER,12   * Address error handler
00002640                                   596  **    MOVE.L  #ILLEGAL_IN,16   * Illegal instruction handler
00002640                                   597  **    MOVE.L  #PRIV_VIOLT,32   * Privilege Violation handler
00002640                                   598  **
00002640                                   599  **    BSR     INIT
00002640                                   600  **    MOVE.W  #$2000,SR        * Permite interrupciones
00002640                                   601  **
00002640                                   602  **BUCPR:
00002640                                   603  **    MOVE.W  #0,CONTC         * Inicializa contador de caracteres
00002640                                   604  **    MOVE.W  #NLIN,CONTL      * Inicializa contador de lineas
00002640                                   605  **    MOVE.L  #BUFFER,DIRLEC   * Direccion de lectura = comienzo del buffer
00002640                                   606  **
00002640                                   607  **OTRAL:
00002640                                   608  **    MOVE.W  #TAML,-(A7)      * Tamano maximo de la linea
00002640                                   609  **    MOVE.W  #DESB,-(A7)      * Puerto A
00002640                                   610  **    MOVE.L  DIRLEC,-(A7)     * Direccion de lectura
00002640                                   611  **
00002640                                   612  **ESPL:
00002640                                   613  **    BSR     SCAN
00002640                                   614  **    CMP.L   #0,D0
00002640                                   615  **    BEQ     ESPL             * Si no se ha leido la linea, se intenta de nuevo
00002640                                   616  **    ADD.L   #8,A7            * Reestablece la pila
00002640                                   617  **    ADD.L   D0,DIRLEC        * Calcula la nueva direccion de lectura
00002640                                   618  **    ADD.W   D0,CONTC         * Actualiza el contador de caracteres
00002640                                   619  **
00002640                                   620  **    SUB.W   #1,CONTL         * Actualiza el numero de lineas leidas.
00002640                                   621  **    BNE     OTRAL            * Si no se han leido todas, se vuelve a leer
00002640                                   622  **
00002640                                   623  **    MOVE.L  #BUFFER,DIRLEC   * DIreccion de lectura = comienzo del buffer
00002640                                   624  **
00002640                                   625  **OTRAE:
00002640                                   626  **    MOVE.W  #TAMB,TAME       * Tamano de escritura = tamano de bloque
00002640                                   627  **
00002640                                   628  **ESPE:
00002640                                   629  **    MOVE.W  TAME,-(A7)       * Tamano de escritura
00002640                                   630  **        MOVE.W  #DESA,-(A7)      * Puerto B
00002640                                   631  **        MOVE.L  DIRLEC,-(A7)     * Direccion de lectura
00002640                                   632  **    * BREAK
00002640                                   633  **    BSR     PRINT
00002640                                   634  **    ADD.L   #8,A7            * Reestablece la pila
00002640                                   635  **    ADD.L   D0,DIRLEC        * Calcula la nueva direccion del buffer
00002640                                   636  **    SUB.W   D0,CONTC         * Actualiza el contador de caracteres
00002640                                   637  **    BEQ     SALIR            * Si no quedan caracteres, se acaba
00002640                                   638  **    SUB.W   D0,TAME          * Actualiza el tamano de escritura
00002640                                   639  **    BNE     ESPE             * Si no se ha escrito todo el bloque, se insiste
00002640                                   640  **    CMP.W   #TAMB,CONTC      * Si el numero de caracteres restantes es menor que el establecido, se transmite ese numero
00002640                                   641  **    BHI     OTRAE            * Siguiente bloque
00002640                                   642  **    MOVE.W  CONTC,TAME
00002640                                   643  **    BRA     ESPE             * Siguiente bloque
00002640                                   644  **
00002640                                   645  **SALIR:
00002640                                   646  **    BRA     BUCPR
00002640                                   647  **
00002640                                   648  **FIN:
00002640                                   649  **    BREAK
00002640                                   650  **
00002640                                   651  **BUS_ERROR:
00002640                                   652  **    BREAK                    * Bus error handler
00002640                                   653  **    NOP
00002640                                   654  **
00002640                                   655  **ADDRESS_ER:
00002640                                   656  **    BREAK                    * Address error handler
00002640                                   657  **    NOP
00002640                                   658  **
00002640                                   659  **ILLEGAL_IN:
00002640                                   660  **    BREAK                    * Illegal instruction handler
00002640                                   661  **    NOP
00002640                                   662  **
00002640                                   663  **PRIV_VIOLT:
00002640                                   664  **    BREAK                    * Priviledge violation handler
00002640                                   665  **    NOP
00002640                                   666  **
00002640                                   667  
00002640                                   668  BUS_ERROR:
00002640  4848                             669      BREAK                    * Bus error handler
00002642  4E71                             670      NOP
00002644                                   671  
00002644                                   672  ADDRESS_ER:
00002644  4848                             673      BREAK                    * Address error handler
00002646  4E71                             674      NOP
00002648                                   675  
00002648                                   676  ILLEGAL_IN:
00002648  4848                             677      BREAK                    * Illegal instruction handler
0000264A  4E71                             678      NOP
0000264C                                   679  
0000264C                                   680  PRIV_VIOLT:
0000264C  4848                             681      BREAK                    * Priviledge violation handler

No errors detected
No warnings generated
